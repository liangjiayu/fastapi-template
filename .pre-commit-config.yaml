# Pre-commit é…ç½® - è½»é‡çº§ç‰ˆæœ¬ï¼Œä¸“æ³¨äºæ ¸å¿ƒæ£€æŸ¥
# å®‰è£…: uv run pre-commit install
# æ‰‹åŠ¨è¿è¡Œ: uv run pre-commit run --all-files
# è·³è¿‡æ£€æŸ¥: git commit --no-verify

repos:
  # ============================================
  # Ruff - Python ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–ï¼ˆå¿«é€Ÿï¼ï¼‰
  # ============================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.0
    hooks:
      # 1. ä»£ç æ ¼å¼åŒ–ï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰
      - id: ruff-format
        name: "ğŸ¨ Ruff Format"
        description: "æ ¼å¼åŒ– Python ä»£ç ï¼ˆç¼©è¿›ã€å¼•å·ã€ç©ºæ ¼ç­‰ï¼‰"

      # 2. ä»£ç æ£€æŸ¥ï¼ˆè‡ªåŠ¨ä¿®å¤ç®€å•é—®é¢˜ï¼‰
      - id: ruff
        name: "ğŸ” Ruff Lint"
        description: "æ£€æŸ¥ä»£ç è´¨é‡ï¼ˆæœªä½¿ç”¨å¯¼å…¥ã€è¯­æ³•é”™è¯¯ç­‰ï¼‰"
        args: [--fix, --exit-non-zero-on-fix]

  # ============================================
  # é€šç”¨æ£€æŸ¥ï¼ˆå¿«é€Ÿï¼Œå‡ ä¹ä¸è€—æ—¶ï¼‰
  # ============================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # æ–‡ä»¶æœ«å°¾ç©ºè¡Œ
      - id: end-of-file-fixer
        name: "ğŸ“„ Fix EOF"
        exclude: "^tests/"

      # å»é™¤è¡Œå°¾ç©ºæ ¼
      - id: trailing-whitespace
        name: "âœ‚ï¸  Trim Whitespace"
        args: [--markdown-linebreak-ext=md]

      # æ£€æŸ¥åˆå¹¶å†²çªæ ‡è®°
      - id: check-merge-conflict
        name: "âš ï¸  Check Merge Conflict"

      # æ£€æŸ¥ YAML è¯­æ³•
      - id: check-yaml
        name: "âœ… Check YAML"
        exclude: "^.vscode/"

      # æ£€æŸ¥ JSON è¯­æ³•ï¼ˆæ’é™¤ VSCode é…ç½®ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒ JSONC æ ¼å¼ï¼‰
      - id: check-json
        name: "âœ… Check JSON"
        exclude: "^.vscode/"

      # é˜²æ­¢æäº¤å¤§æ–‡ä»¶ï¼ˆè¶…è¿‡ 500KBï¼‰
      - id: check-added-large-files
        name: "ğŸ“¦ Check Large Files"
        args: [--maxkb=500]

# ============================================
# æ€§èƒ½é…ç½®
# ============================================
# å¹¶è¡Œæ‰§è¡Œï¼ˆåŠ å¿«é€Ÿåº¦ï¼‰
default_install_hook_types: [pre-commit]
fail_fast: false  # æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªé”™è¯¯å°±åœæ­¢

# ============================================
# æ’é™¤æ–‡ä»¶
# ============================================
exclude: |
  (?x)^(
    \.venv/|
    \.git/|
    __pycache__/|
    alembic/versions/.*\.py|
    \.pytest_cache/|
    \.ruff_cache/
  )$
